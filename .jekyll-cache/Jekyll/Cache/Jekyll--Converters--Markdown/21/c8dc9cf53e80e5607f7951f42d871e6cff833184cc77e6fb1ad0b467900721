I"Î@
<ul id="markdown-toc">
  <li><a href="#session" id="markdown-toc-session">Session</a>    <ul>
      <li><a href="#sessionì´ë€" id="markdown-toc-sessionì´ë€">Sessionì´ë€</a></li>
      <li><a href="#sessionì˜-ë™ì‘-ë°©ì‹" id="markdown-toc-sessionì˜-ë™ì‘-ë°©ì‹">Sessionì˜ ë™ì‘ ë°©ì‹</a></li>
      <li><a href="#expressì—-session-íŒ¨í‚¤ì§€-ì„¤ì¹˜" id="markdown-toc-expressì—-session-íŒ¨í‚¤ì§€-ì„¤ì¹˜">Expressì— Session íŒ¨í‚¤ì§€ ì„¤ì¹˜</a></li>
      <li><a href="#mysqlì„-expressì˜-session-storeë¡œ-ì‚¬ìš©" id="markdown-toc-mysqlì„-expressì˜-session-storeë¡œ-ì‚¬ìš©">Mysqlì„ Expressì˜ Session storeë¡œ ì‚¬ìš©</a></li>
      <li><a href="#ì‚¬ìš©-ì˜ˆ" id="markdown-toc-ì‚¬ìš©-ì˜ˆ">ì‚¬ìš© ì˜ˆ</a></li>
    </ul>
  </li>
</ul>

<h1 id="session">Session</h1>

<p>ìì„¸í•œ ë‚´ìš©ì€ <a href="https://opentutorials.org/course/2136/12068">ìƒí™œì½”ë”© Javascript(nodejs)</a>ê°•ì¢Œë¥¼ ì°¸ê³ í•˜ì„¸ìš”.</p>

<h2 id="sessionì´ë€">Sessionì´ë€</h2>

<p>ì¿ í‚¤ë¥¼ ê°œì„ í•œ ë°©ì‹ìœ¼ë¡œ ì¿ í‚¤ë³´ë‹¤ ì¢€ë” ì•ˆì „í•˜ê²Œ ë°©ëŒ€í•œ ë°ì´í„°ë¥¼ ì €ì¥ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.<br />
ì¦‰, ì‚¬ìš©ìì˜ ì»´í“¨í„°ì™€ ì„œë²„ê°€ í†µì‹ í•˜ëŠ” ê³¼ì •ì—ì„œ ì•„ì´ë””ë‚˜ ë¹„ë°€ë²ˆí˜¸ì™€ ê°™ì€ ì¤‘ìš”í•œ ì •ë³´ê°€ ì˜¤ê³  ê°„ë‹¤ëŠ” ê²ƒì€ êµ‰ì¥íˆ ìœ„í—˜í•œ ì¼ì´ë¯€ë¡œ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ì„œ ì¿ í‚¤ê°€ ê°€ì§€ê³  ìˆëŠ” ê¸°ëŠ¥ê³¼ ì„œë²„ìª½ì—ì„œ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ê³µê°„ì„ ì˜ ê²°í•©í•œ ì„¸ì…˜ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì•ˆì „í•©ë‹ˆë‹¤.</p>

<h2 id="sessionì˜-ë™ì‘-ë°©ì‹">Sessionì˜ ë™ì‘ ë°©ì‹</h2>

<p>ì‚¬ìš©ìê°€ ì„œë²„ì— ì ‘ì†ì„ í•˜ë©´ ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸(ì‚¬ìš©ìì˜ ì»´í“¨í„°)ì— ë°ì´í„°ë¥¼ ì €ì¥í•  ë•Œ ì¿ í‚¤
ë°©ì‹ê³¼ëŠ” ë‹¤ë¥´ê²Œ ì‚¬ìš©ìì˜ <strong>ì‹ë³„ì(id) ê°’</strong> ë§Œì„ ì €ì¥í•©ë‹ˆë‹¤.
ì‚¬ìš©ìì˜ ì»´í“¨í„°ì—ëŠ” ì˜¤ì§ ì‹ë³„ì ê°’ë§Œ ì €ì¥ë˜ì–´ìˆê³  í•´ë‹¹ ì‹ë³„ì ê°’ì— í•´ë‹¹í•˜ëŠ” <strong>ì‹¤ì œ ë°ì´í„°ëŠ”
ì„œë²„ì˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥</strong> ë˜ì–´ìˆëŠ” ê²ƒì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì„œë²„ì— ì ‘ì†í•˜ì—¬ ìš”ì²­ìœ¼ë¡œ ì‹ë³„ìë¥¼
ì „ì†¡í•˜ë©´ ê·¸ ì‹ë³„ìì— í•´ë‹¹í•˜ëŠ” ì‹¤ì œ ë°ì´í„°ë¥¼ ì„œë²„ì˜ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì½ì–´ì™€ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒ ì…ë‹ˆë‹¤.</p>

<h2 id="expressì—-session-íŒ¨í‚¤ì§€-ì„¤ì¹˜">Expressì— Session íŒ¨í‚¤ì§€ ì„¤ì¹˜</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">npm</span> <span class="n">install</span> <span class="n">express</span><span class="o">-</span><span class="n">session</span> <span class="o">--</span><span class="n">save</span>
</code></pre></div></div>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express-session</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">({</span>
<span class="err">â€‹</span>	<span class="na">secret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">12sdfwerwersdfserwerwef</span><span class="dl">'</span><span class="p">,</span> <span class="c1">//keboard cat (ëœë¤í•œ ê°’)</span>
<span class="err">â€‹</span>	<span class="na">resave</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="err">â€‹</span>	<span class="na">saveUninitialized</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
<span class="err">â€‹</span>	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connected 3000 port!!!</span><span class="dl">'</span><span class="p">);</span>		
<span class="p">});</span></code></pre></figure>

<h2 id="mysqlì„-expressì˜-session-storeë¡œ-ì‚¬ìš©">Mysqlì„ Expressì˜ Session storeë¡œ ì‚¬ìš©</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">npm</span> <span class="n">install</span> <span class="n">express</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">session</span> <span class="o">--</span><span class="n">save</span>
</code></pre></div></div>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express-session</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">MySQLStore</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">express-mysql-session</span><span class="dl">'</span><span class="p">)(</span><span class="nx">session</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">mysql</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mysql</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">conn</span> <span class="o">=</span> <span class="nx">mysql</span><span class="p">.</span><span class="nx">createConnection</span><span class="p">({</span>
<span class="err">â€‹</span>	<span class="na">host</span>     <span class="p">:</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
<span class="err">â€‹</span>	<span class="na">user</span>     <span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">,</span>
<span class="err">â€‹</span>	<span class="na">password</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">password</span><span class="dl">'</span><span class="p">,</span>
<span class="err">â€‹</span>	<span class="na">database</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span>
<span class="p">});</span>
<span class="nx">conn</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>

<span class="c1">//POST ë°©ì‹ì„ ì´ìš©í•œ ì •ë³´ ì „ë‹¬ì„ ê°€ëŠ¥í•˜ê²Œ í•¨(req.body.###)</span>
<span class="kd">var</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">body-parser</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
<span class="err">â€‹</span>	<span class="na">host</span>	<span class="p">:</span> <span class="dl">'</span><span class="s1">localhost</span><span class="dl">'</span><span class="p">,</span>
<span class="err">â€‹</span>	<span class="na">port</span>	<span class="p">:</span> <span class="mi">3306</span><span class="p">,</span>
<span class="err">â€‹</span>	<span class="na">user</span>	<span class="p">:</span> <span class="dl">'</span><span class="s1">root</span><span class="dl">'</span><span class="p">,</span>
<span class="err">â€‹</span>	<span class="na">password</span><span class="p">:</span> <span class="dl">'</span><span class="s1">password</span><span class="dl">'</span><span class="p">,</span>		<span class="c1">//ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ë¹„ë°€ë²ˆí˜¸</span>
<span class="err">â€‹</span>	<span class="na">database</span><span class="p">:</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span>		<span class="c1">//ë°ì´í„°ë² ì´ìŠ¤ì˜ ì´ë¦„</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">sessionStore</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MySQLStore</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">session</span><span class="p">({</span>
<span class="err">â€‹</span>	<span class="na">secret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">12sdfwerwersdfserwerwef</span><span class="dl">'</span><span class="p">,</span> <span class="c1">//keboard cat (ëœë¤í•œ ê°’)</span>
<span class="err">â€‹</span>	<span class="na">resave</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
<span class="err">â€‹</span>	<span class="na">saveUninitialized</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
<span class="err">â€‹</span>	<span class="na">store</span><span class="p">:</span> <span class="nx">sessionStore</span>
<span class="p">}));</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
<span class="err">â€‹</span>	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Connected 3000 port!!!</span><span class="dl">'</span><span class="p">);</span>		
<span class="p">});</span></code></pre></figure>

<h2 id="ì‚¬ìš©-ì˜ˆ">ì‚¬ìš© ì˜ˆ</h2>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//ì„¸ì…˜ ì €ì¥ ì—¬ë¶€ì— ë”°ë¼ ë¡œê·¸ì¸ ê²°ì •</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="err">â€‹</span>	<span class="k">if</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">authId</span><span class="p">)</span>
<span class="err">â€‹</span>		<span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">authId</span><span class="o">+</span><span class="dl">'</span><span class="s1">ë‹˜ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤</span><span class="dl">'</span><span class="p">);</span>
<span class="err">â€‹</span>	<span class="k">else</span>
<span class="err">â€‹</span>		<span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">ë¡œê·¸ì¸í•˜ì„¸ìš”!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ìœ ì €ê°€ ê°€ì…í•˜ë©´ ì‚¬ìš©ì ì•„ì´ë””ë¥¼ ì„¸ì…˜ë°ì´í„°ë¡œ ì €ì¥í•˜ì—¬ ìë™ ë¡œê·¸ì¸</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/auth/register</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="err">â€‹</span>	<span class="kd">var</span> <span class="nx">user</span><span class="o">=</span><span class="p">{</span>
<span class="err">â€‹</span>		<span class="na">AuthId</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">authId</span><span class="p">,</span>
<span class="err">â€‹</span>		<span class="na">Password</span><span class="p">:</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">password</span>
<span class="err">â€‹</span>	<span class="p">};</span>
<span class="err">â€‹</span>	<span class="kd">var</span> <span class="nx">sql</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">INSERT INTO users SET ?</span><span class="dl">'</span><span class="p">;</span>
<span class="err">â€‹</span>	<span class="nx">conn</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">user</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
<span class="err">â€‹</span>		<span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
<span class="err">â€‹</span>			<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="err">â€‹</span>		<span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="err">â€‹</span>			<span class="c1">//ì‚¬ìš©ì ì•„ì´ë””ë¥¼ ì„¸ì…˜ ë°ì´í„°ë¡œ ì €ì¥</span>
<span class="err">â€‹</span>			<span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">authId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">authId</span><span class="p">;</span>
<span class="err">â€‹</span>			<span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="err">â€‹</span>				<span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">);</span>		
<span class="err">â€‹</span>			<span class="p">});</span>
<span class="err">â€‹</span>		<span class="p">}</span>		
<span class="err">â€‹</span>	<span class="p">})</span>
<span class="p">});</span>

<span class="c1">//ìœ ì €ì˜ ì„¸ì…˜ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì—¬ ë¡œê·¸ì•„ì›ƒ</span>
<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/logout</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
<span class="err">â€‹</span>	<span class="k">delete</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">authId</span><span class="p">;</span>
<span class="err">â€‹</span>	<span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="err">â€‹</span>		<span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">);</span>
<span class="err">â€‹</span>	<span class="p">});</span>
<span class="p">});</span></code></pre></figure>

:ET